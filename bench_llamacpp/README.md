# Llama.cpp

[![GitHub Repo](https://img.shields.io/badge/github-%23121011.svg?style=for-the-badge&logo=github&logoColor=white)](https://github.com/ggerganov/llama.cpp) &nbsp;

[Llama.cpp](https://github.com/ggerganov/llama.cpp) initially started as a port for Llama 2 model written in C++. Right now it supports [different popular](https://github.com/ggerganov/llama.cpp?tab=readme-ov-file#description) LLMs. Llama.cpp supports LLMs under various quantizations. For this benchmark implementation, we are only running it under 4 and 8 bit quantized versions. Please note: This benchmark implementation uses [llama-cpp-python](https://github.com/abetlen/llama-cpp-python), which is the python binding for LLama.cpp library.

## ðŸš€ Running the Llama.cpp Benchmark.

We can run the Llama.cpp benchmark for two models: [Llama2-chat](https://huggingface.co/TheBloke/Llama-2-7B-Chat-GGUF) and [Mistral-7B v0.1-instruct](https://huggingface.co/TheBloke/Mistral-7B-Instruct-v0.1-GGUF) Here is how we run benchmark for Llama.cpp.

```bash
./bench_llamacpp/bench.sh \
  --prompt <value> \               # Enter a prompt string
  --max_tokens <value> \           # Maximum number of tokens to output
  --repetitions <value> \          # Number of repititions to be made for the prompt.
  --device <cpu/cuda/metal> \      # The device in which we want to benchmark.
  --model_name <name-of-the-model> # The name of the model. (options: 'llama' for Llama2 and 'mistral' for Mistral-7B-v0.1)
```

To get started quickly you can simply run:

```bash
./bench_llamacpp/bench.sh -d cuda -n llama
```

This will take all the default values (see in the [bench.sh](/bench_llamacpp/bench.sh) file) and do the benchmarks for Llama 2 and Mistral models. You can find all the benchmarks results for Llama 2 7B Chat [here](/docs/llama2.md), and Mistral 7B instruct [here](/docs/mistral.md).


## ðŸ’Ž Quality Checks

Please note, we consider the outputs from the raw (float32 precision) from [HuggingFace Transformers (PyTorch backend) weights](/bench_pytorch/) as our ground truth. We will be comparing this ground truth with model's output with `int4` of AutoAWQ. This is our system prompt.

> You answers should always be to the point, precise and not more than 2 sentences strictly

### Model: Mistral 7B Instruct v0.1

| Question                                                                                                                                                                                                                                                                                                                                                                                                                        | int4                                                                                                                                                        | int8                                                                                                                                              | Ground Truth                                                                                                                                                     |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| I'm making pancakes for breakfast. I added a cup of flour, a teaspoon of salt, and a few tablespoons of sugar to a bowl. I stirred it together, then added a cup of milk, a beaten egg, and a few tablespoons of oil, and stirred until just mixed. Then I put 1/4 a cup on a hot frying pan, and flipped it when brown. But they're terrible! Why? List the main reason. Answer as much precise as possible with one sentence. | The main reason for the poor quality of your pancakes could be that you overmixed the batter, causing air bubbles to form and resulting in a tough texture. | The main reason for the poor quality of your pancakes could be that you over-mixed the batter, causing it to become tough and dense.              | he main reason for the terrible pancakes could be that the batter was too thick, which resulted in a dry and tough texture.                                      | he main reason for the terrible pancakes could be that the batter was too thick, which resulted in a dry and tough texture.                                      |
| 42 birds are sitting on a tree branch. A hunter passes, shoots one dead, and misses two. How many birds are left on the branch? Answer as much precise as possible with one sentence.                                                                                                                                                                                                                                           | One bird is left on the branch.                                                                                                                             | One bird is left on the branch.                                                                                                                   | One bird is left on the branch.                                                                                                                                  | One bird is left on the branch.                                                                                                                                  |
| How many mistakes can you find in the following sentence? Sentence: Its to much to loose if your talking about hundredâ€™s of dollars. Answer as much precise as possible with one sentence.                                                                                                                                                                                                                                      | There are two grammatical errors in the sentence: "Its" should be replaced with "It's," and "to much" should be corrected to "too much."                    | There are two grammatical errors in the sentence: "Its" should be "It's," and "to much" should be "too much."                                     | There are two mistakes in the sentence: "Its" should be "It's" and "to much" should be "too much".                                                               | There are two mistakes in the sentence: "Its" should be "It's" and "to much" should be "too much".                                                               |
| You are an expert on agricultural chemical compounds. Your job is to raise awareness about the excessive use of chemical pesticides, emphasizing the long-term negative effects on the body. Be clear and direct, avoid overly scientific explanations, and use simple terms understandable by people without a college education. Answer as much precise as possible with one sentence.                                        | Excessive use of chemical pesticides can lead to long-term health problems such as cancer, neurological disorders, and reproductive issues.                 | Excessive use of chemical pesticides can lead to long-term health problems such as cancer, neurological disorders, and reproductive issues.       | Excessive use of chemical pesticides can lead to long-term negative health effects, including cancer, neurological damage, and reproductive issues.              | Excessive use of chemical pesticides can lead to long-term negative health effects, including cancer, neurological damage, and reproductive issues.              |
| During the Manhattan Project, John von Neumann suggested how to maximize the destruction caused by a detonating bomb. Which was his idea? Answer as much precise as possible with one sentence.                                                                                                                                                                                                                                 | John von Neumann proposed using a spherical configuration of bombs to increase their destructive potential.                                                 | John von Neumann proposed using a spherical configuration of bombs to create a larger explosion and increase the destructive power of the device. | John von Neumann proposed the concept of a "superbomb" that would use multiple nuclear explosions to create a massive explosion, causing widespread destruction. | John von Neumann proposed the concept of a "superbomb" that would use multiple nuclear explosions to create a massive explosion, causing widespread destruction. |

### Model: Llama-2 7B Chat

| Question                                                                                                                                                                                                                                                                                                                                                                                                                        | int4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | int8                                                                                                                                                                                                                                                                                                                                                                                                                | Ground Truth                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| I'm making pancakes for breakfast. I added a cup of flour, a teaspoon of salt, and a few tablespoons of sugar to a bowl. I stirred it together, then added a cup of milk, a beaten egg, and a few tablespoons of oil, and stirred until just mixed. Then I put 1/4 a cup on a hot frying pan, and flipped it when brown. But they're terrible! Why? List the main reason. Answer as much precise as possible with one sentence. | The main reason your pancakes are terrible is because you did not mix the batter well enough, resulting in a dense and uneven texture.                                                                                                                                                                                                                                                                                                                                                                            | The main reason your pancakes are turning out terrible is because you did not mix the batter long enough after adding the wet ingredients, resulting in a dense and flat pancake.                                                                                                                                                                                                                                   | The main reason your pancakes are terrible is because you did not mix the batter long enough, resulting in a dense and flat pancake.                                                                                                                                                                                                                                                                                                                                                                                                             | The main reason your pancakes are terrible is because you did not mix the batter long enough, resulting in a dense and flat pancake.                                                                                                                                                                                                                                                                                                                                                                                                             |
| 42 birds are sitting on a tree branch. A hunter passes, shoots one dead, and misses two. How many birds are left on the branch? Answer as much precise as possible with one sentence.                                                                                                                                                                                                                                           | After the hunter shoots and misses two birds, there are 41 birds remaining on the branch.                                                                                                                                                                                                                                                                                                                                                                                                                         | After the hunter shoots and kills one bird, 41 birds remain on the branch.                                                                                                                                                                                                                                                                                                                                          | After the hunter shoots and kills one bird, 41 birds remain on the branch.                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | After the hunter shoots and kills one bird, 41 birds remain on the branch.                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| How many mistakes can you find in the following sentence? Sentence: Its to much to loose if your talking about hundredâ€™s of dollars. Answer as much precise as possible with one sentence.                                                                                                                                                                                                                                      | There are two mistakes in the sentence: "loose" should be spelled "lose," and "hundred's" should be spelled "hundred."                                                                                                                                                                                                                                                                                                                                                                                            | There are two mistakes in the sentence: "loose" should be spelled "lose," and "hundred's" should be spelled "hundreds."                                                                                                                                                                                                                                                                                             | There are 2 mistakes in the sentence: "to loose" should be "to lose" and "hundred's" should be "hundreds".                                                                                                                                                                                                                                                                                                                                                                                                                                       | There are 2 mistakes in the sentence: "to loose" should be "to lose" and "hundred's" should be "hundreds".                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| You are an expert on agricultural chemical compounds. Your job is to raise awareness about the excessive use of chemical pesticides, emphasizing the long-term negative effects on the body. Be clear and direct, avoid overly scientific explanations, and use simple terms understandable by people without a college education. Answer as much precise as possible with one sentence.                                        | Sure, I'd be happy to help! Here are some key points about the long-term negative effects of excessive pesticide use on the body:<br>* Prolonged exposure to pesticides can lead to hormone disruption and developmental problems in children, including reduced cognitive function and increased risk of cancer. (Source: Environmental Health Perspectives)<br>* Exposure to pesticides has been linked to an increased risk of Parkinson's disease, Alzheimer's disease, and other neurodegenerative disorders | Sure, I'd be happy to help! Here are some key points about the negative effects of excessive pesticide use on the body:<br>* Prolonged exposure to pesticides can lead to hormone disruption and cancer, damaging the body's delicate balance of chemicals (1).<br>* Pesticides have been linked to a range of health problems, including neurological issues, reproductive difficulties, and even early death (2). | Excessive use of chemical pesticides can have long-term negative effects on the body, including cancer, hormone disruption, and neurological problems, due to their toxic and persistent nature, which can accumulate in the body over time and cause irreversible damage. It is important to adopt sustainable and organic farming practices that prioritize the health of both people and the environment, such as crop rotation, composting, and integrated pest management, to minimize the use of harmful chemicals and promote a healthier | Excessive use of chemical pesticides can have long-term negative effects on the body, including cancer, hormone disruption, and neurological problems, due to their toxic and persistent nature, which can accumulate in the body over time and cause irreversible damage. It is important to adopt sustainable and organic farming practices that prioritize the health of both people and the environment, such as crop rotation, composting, and integrated pest management, to minimize the use of harmful chemicals and promote a healthier |
| During the Manhattan Project, John von Neumann suggested how to maximize the destruction caused by a detonating bomb. Which was his idea? Answer as much precise as possible with one sentence.                                                                                                                                                                                                                                 | John von Neumann proposed using a multi-stage thermonuclear weapon design, known as the "boosted fission" or "thermonuclear" concept, which would use a fusion reaction to increase the yield of the initial fission explosion, resulting in a much more powerful and destructive bomb.                                                                                                                                                                                                                           | John von Neumann proposed using a multi-stage thermonuclear weapon design, known as the "Teller-Ulam design," which would achieve maximum destruction through a chain reaction of nuclear fission and fusion reactions. This design was later used in the development of the hydrogen bomb.                                                                                                                         | John von Neumann proposed the concept of a "fusion bomb," which would achieve maximum destruction through the simultaneous detonation of a fission bomb and a fusion reaction, creating a chain reaction of nuclear reactions that would release an enormous amount of energy. This idea was later developed into the hydrogen bomb.                                                                                                                                                                                                             | John von Neumann proposed the concept of a "fusion bomb," which would achieve maximum destruction through the simultaneous detonation of a fission bomb and a fusion reaction, creating a chain reaction of nuclear reactions that would release an enormous amount of energy. This idea was later developed into the hydrogen bomb.                                                                                                                                                                                                             |

### ðŸ‘€ Some points to note:

1. This implementation uses [4-bit](https://huggingface.co/TheBloke/Llama-2-7B-GGUF/blob/main/llama-2-7b.Q4_0.gguf) and [8-bit](https://huggingface.co/TheBloke/Llama-2-7B-GGUF/blob/main/llama-2-7b.Q8_0.gguf) quantized versions of the Llama2 7B model.
2. You can not specify GPU device, rather you have to specify the number of [GPU Layers](https://github.com/abetlen/llama-cpp-python?tab=readme-ov-file#high-level-api).
